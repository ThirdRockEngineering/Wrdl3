{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar errors = require('../errors.js');\n\nasync function hasWithFallback(key, has, store) {\n  const result = await has(key);\n\n  if (result) {\n    return result;\n  }\n\n  const levelJs = findLevelJs(store);\n\n  if (!levelJs) {\n    return false;\n  }\n\n  return new Promise((resolve, reject) => {\n    const req = levelJs.store('readonly').get(key.toString());\n\n    req.transaction.onabort = () => {\n      reject(req.transaction.error);\n    };\n\n    req.transaction.oncomplete = () => {\n      resolve(Boolean(req.result));\n    };\n  });\n}\n\nasync function getWithFallback(key, get, has, store) {\n  if (await has(key)) {\n    return get(key);\n  }\n\n  const levelJs = findLevelJs(store);\n\n  if (!levelJs) {\n    throw new errors.NotFoundError();\n  }\n\n  return new Promise((resolve, reject) => {\n    const req = levelJs.store('readonly').get(key.toString());\n\n    req.transaction.onabort = () => {\n      reject(req.transaction.error);\n    };\n\n    req.transaction.oncomplete = () => {\n      if (req.result) {\n        return resolve(req.result);\n      }\n\n      reject(new errors.NotFoundError());\n    };\n  });\n}\n\nfunction findLevelJs(store) {\n  let db = store;\n\n  while (db.db || db.child) {\n    db = db.db || db.child;\n\n    if (db.type === 'level-js' || db.constructor.name === 'Level') {\n      return db;\n    }\n  }\n}\n\nexports.getWithFallback = getWithFallback;\nexports.hasWithFallback = hasWithFallback;","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/ipfs-repo/cjs/src/utils/level.js"],"names":["Object","defineProperty","exports","value","errors","require","hasWithFallback","key","has","store","result","levelJs","findLevelJs","Promise","resolve","reject","req","get","toString","transaction","onabort","error","oncomplete","Boolean","getWithFallback","NotFoundError","db","child","type","constructor","name"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AAEA,IAAIC,MAAM,GAAGC,OAAO,CAAC,cAAD,CAApB;;AAEA,eAAeC,eAAf,CAA+BC,GAA/B,EAAoCC,GAApC,EAAyCC,KAAzC,EAAgD;AAC9C,QAAMC,MAAM,GAAG,MAAMF,GAAG,CAACD,GAAD,CAAxB;;AACA,MAAIG,MAAJ,EAAY;AACV,WAAOA,MAAP;AACD;;AACD,QAAMC,OAAO,GAAGC,WAAW,CAACH,KAAD,CAA3B;;AACA,MAAI,CAACE,OAAL,EAAc;AACZ,WAAO,KAAP;AACD;;AACD,SAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,GAAG,GAAGL,OAAO,CAACF,KAAR,CAAc,UAAd,EAA0BQ,GAA1B,CAA8BV,GAAG,CAACW,QAAJ,EAA9B,CAAZ;;AACAF,IAAAA,GAAG,CAACG,WAAJ,CAAgBC,OAAhB,GAA0B,MAAM;AAC9BL,MAAAA,MAAM,CAACC,GAAG,CAACG,WAAJ,CAAgBE,KAAjB,CAAN;AACD,KAFD;;AAGAL,IAAAA,GAAG,CAACG,WAAJ,CAAgBG,UAAhB,GAA6B,MAAM;AACjCR,MAAAA,OAAO,CAACS,OAAO,CAACP,GAAG,CAACN,MAAL,CAAR,CAAP;AACD,KAFD;AAGD,GARM,CAAP;AASD;;AACD,eAAec,eAAf,CAA+BjB,GAA/B,EAAoCU,GAApC,EAAyCT,GAAzC,EAA8CC,KAA9C,EAAqD;AACnD,MAAI,MAAMD,GAAG,CAACD,GAAD,CAAb,EAAoB;AAClB,WAAOU,GAAG,CAACV,GAAD,CAAV;AACD;;AACD,QAAMI,OAAO,GAAGC,WAAW,CAACH,KAAD,CAA3B;;AACA,MAAI,CAACE,OAAL,EAAc;AACZ,UAAM,IAAIP,MAAM,CAACqB,aAAX,EAAN;AACD;;AACD,SAAO,IAAIZ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,GAAG,GAAGL,OAAO,CAACF,KAAR,CAAc,UAAd,EAA0BQ,GAA1B,CAA8BV,GAAG,CAACW,QAAJ,EAA9B,CAAZ;;AACAF,IAAAA,GAAG,CAACG,WAAJ,CAAgBC,OAAhB,GAA0B,MAAM;AAC9BL,MAAAA,MAAM,CAACC,GAAG,CAACG,WAAJ,CAAgBE,KAAjB,CAAN;AACD,KAFD;;AAGAL,IAAAA,GAAG,CAACG,WAAJ,CAAgBG,UAAhB,GAA6B,MAAM;AACjC,UAAIN,GAAG,CAACN,MAAR,EAAgB;AACd,eAAOI,OAAO,CAACE,GAAG,CAACN,MAAL,CAAd;AACD;;AACDK,MAAAA,MAAM,CAAC,IAAIX,MAAM,CAACqB,aAAX,EAAD,CAAN;AACD,KALD;AAMD,GAXM,CAAP;AAYD;;AACD,SAASb,WAAT,CAAqBH,KAArB,EAA4B;AAC1B,MAAIiB,EAAE,GAAGjB,KAAT;;AACA,SAAOiB,EAAE,CAACA,EAAH,IAASA,EAAE,CAACC,KAAnB,EAA0B;AACxBD,IAAAA,EAAE,GAAGA,EAAE,CAACA,EAAH,IAASA,EAAE,CAACC,KAAjB;;AACA,QAAID,EAAE,CAACE,IAAH,KAAY,UAAZ,IAA0BF,EAAE,CAACG,WAAH,CAAeC,IAAf,KAAwB,OAAtD,EAA+D;AAC7D,aAAOJ,EAAP;AACD;AACF;AACF;;AAEDxB,OAAO,CAACsB,eAAR,GAA0BA,eAA1B;AACAtB,OAAO,CAACI,eAAR,GAA0BA,eAA1B","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar errors = require('../errors.js');\n\nasync function hasWithFallback(key, has, store) {\n  const result = await has(key);\n  if (result) {\n    return result;\n  }\n  const levelJs = findLevelJs(store);\n  if (!levelJs) {\n    return false;\n  }\n  return new Promise((resolve, reject) => {\n    const req = levelJs.store('readonly').get(key.toString());\n    req.transaction.onabort = () => {\n      reject(req.transaction.error);\n    };\n    req.transaction.oncomplete = () => {\n      resolve(Boolean(req.result));\n    };\n  });\n}\nasync function getWithFallback(key, get, has, store) {\n  if (await has(key)) {\n    return get(key);\n  }\n  const levelJs = findLevelJs(store);\n  if (!levelJs) {\n    throw new errors.NotFoundError();\n  }\n  return new Promise((resolve, reject) => {\n    const req = levelJs.store('readonly').get(key.toString());\n    req.transaction.onabort = () => {\n      reject(req.transaction.error);\n    };\n    req.transaction.oncomplete = () => {\n      if (req.result) {\n        return resolve(req.result);\n      }\n      reject(new errors.NotFoundError());\n    };\n  });\n}\nfunction findLevelJs(store) {\n  let db = store;\n  while (db.db || db.child) {\n    db = db.db || db.child;\n    if (db.type === 'level-js' || db.constructor.name === 'Level') {\n      return db;\n    }\n  }\n}\n\nexports.getWithFallback = getWithFallback;\nexports.hasWithFallback = hasWithFallback;\n"]},"metadata":{},"sourceType":"script"}