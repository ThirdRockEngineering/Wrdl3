{"ast":null,"code":"'use strict';\n\nconst Shake = require('it-handshake');\n\nconst lp = require('it-length-prefixed');\n\nmodule.exports = function (duplex) {\n  let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const shake = Shake(duplex);\n  const lpReader = lp.decode.fromReader(shake.reader, opts);\n  let isDone = false;\n  const W = {\n    read: async bytes => {\n      // just read\n      const {\n        value,\n        done\n      } = await shake.reader.next(bytes);\n\n      if (done && value.length < bytes) {\n        throw new Error('Couldn\\'t read enough bytes');\n      }\n\n      isDone = done;\n\n      if (!value) {\n        throw new Error('Value is null');\n      }\n\n      return value;\n    },\n    readLP: async () => {\n      // read, decode\n      const {\n        value,\n        done\n      } = await lpReader.next();\n      isDone = done;\n\n      if (!value) {\n        throw new Error('Value is null');\n      }\n\n      return value;\n    },\n    readPB: async proto => {\n      // readLP, decode\n      const value = await W.readLP();\n\n      if (!value) {\n        throw new Error('Value is null');\n      } // Is this a Uint8Array?\n\n\n      const buf = value instanceof Uint8Array ? value : value.slice();\n      return proto.decode(buf);\n    },\n    write: data => {\n      // just write\n      shake.writer.push(data);\n    },\n    writeLP: data => {\n      // encode, write\n      W.write(lp.encode.single(data, opts));\n    },\n    writePB: (data, proto) => {\n      // encode, writeLP\n      W.writeLP(proto.encode(data));\n    },\n    pb: proto => {\n      return {\n        read: () => W.readPB(proto),\n        write: d => W.writePB(d, proto)\n      };\n    },\n    unwrap: () => {\n      // returns vanilla duplex again, terminates all reads/writes from this object\n      shake.rest();\n      return shake.stream;\n    }\n  };\n  return W;\n};","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/it-pb-rpc/src/index.js"],"names":["Shake","require","lp","module","exports","duplex","opts","shake","lpReader","decode","fromReader","reader","isDone","W","read","bytes","value","done","next","length","Error","readLP","readPB","proto","buf","Uint8Array","slice","write","data","writer","push","writeLP","encode","single","writePB","pb","d","unwrap","rest","stream"],"mappings":"AAAA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,cAAD,CAArB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAC,oBAAD,CAAlB;;AAEAE,MAAM,CAACC,OAAP,GAAiB,UAACC,MAAD,EAAuB;AAAA,MAAdC,IAAc,uEAAP,EAAO;AACtC,QAAMC,KAAK,GAAGP,KAAK,CAACK,MAAD,CAAnB;AACA,QAAMG,QAAQ,GAAGN,EAAE,CAACO,MAAH,CAAUC,UAAV,CACbH,KAAK,CAACI,MADO,EAEbL,IAFa,CAAjB;AAKA,MAAIM,MAAM,GAAG,KAAb;AAEA,QAAMC,CAAC,GAAG;AACRC,IAAAA,IAAI,EAAE,MAAOC,KAAP,IAAiB;AACrB;AAEA,YAAM;AAAEC,QAAAA,KAAF;AAASC,QAAAA;AAAT,UAAkB,MAAMV,KAAK,CAACI,MAAN,CAAaO,IAAb,CAAkBH,KAAlB,CAA9B;;AAEA,UAAIE,IAAI,IAAID,KAAK,CAACG,MAAN,GAAeJ,KAA3B,EAAkC;AAChC,cAAM,IAAIK,KAAJ,CAAU,6BAAV,CAAN;AACD;;AAEDR,MAAAA,MAAM,GAAGK,IAAT;;AAEA,UAAI,CAACD,KAAL,EAAY;AAAE,cAAM,IAAII,KAAJ,CAAU,eAAV,CAAN;AAAkC;;AAChD,aAAOJ,KAAP;AACD,KAdO;AAeRK,IAAAA,MAAM,EAAE,YAAY;AAClB;AACA,YAAM;AAAEL,QAAAA,KAAF;AAASC,QAAAA;AAAT,UAAkB,MAAMT,QAAQ,CAACU,IAAT,EAA9B;AAEAN,MAAAA,MAAM,GAAGK,IAAT;;AAEA,UAAI,CAACD,KAAL,EAAY;AAAE,cAAM,IAAII,KAAJ,CAAU,eAAV,CAAN;AAAkC;;AAChD,aAAOJ,KAAP;AACD,KAvBO;AAwBRM,IAAAA,MAAM,EAAE,MAAOC,KAAP,IAAiB;AACvB;AACA,YAAMP,KAAK,GAAG,MAAMH,CAAC,CAACQ,MAAF,EAApB;;AAEA,UAAI,CAACL,KAAL,EAAY;AAAE,cAAM,IAAII,KAAJ,CAAU,eAAV,CAAN;AAAkC,OAJzB,CAMvB;;;AACA,YAAMI,GAAG,GAAGR,KAAK,YAAYS,UAAjB,GAA8BT,KAA9B,GAAsCA,KAAK,CAACU,KAAN,EAAlD;AAEA,aAAOH,KAAK,CAACd,MAAN,CAAae,GAAb,CAAP;AACD,KAlCO;AAmCRG,IAAAA,KAAK,EAAGC,IAAD,IAAU;AACf;AACArB,MAAAA,KAAK,CAACsB,MAAN,CAAaC,IAAb,CAAkBF,IAAlB;AACD,KAtCO;AAuCRG,IAAAA,OAAO,EAAGH,IAAD,IAAU;AACjB;AACAf,MAAAA,CAAC,CAACc,KAAF,CAAQzB,EAAE,CAAC8B,MAAH,CAAUC,MAAV,CAAiBL,IAAjB,EAAuBtB,IAAvB,CAAR;AACD,KA1CO;AA2CR4B,IAAAA,OAAO,EAAE,CAACN,IAAD,EAAOL,KAAP,KAAiB;AACxB;AACAV,MAAAA,CAAC,CAACkB,OAAF,CAAUR,KAAK,CAACS,MAAN,CAAaJ,IAAb,CAAV;AACD,KA9CO;AAgDRO,IAAAA,EAAE,EAAGZ,KAAD,IAAW;AACb,aAAO;AACLT,QAAAA,IAAI,EAAE,MAAMD,CAAC,CAACS,MAAF,CAASC,KAAT,CADP;AAELI,QAAAA,KAAK,EAAGS,CAAD,IAAOvB,CAAC,CAACqB,OAAF,CAAUE,CAAV,EAAab,KAAb;AAFT,OAAP;AAID,KArDO;AAuDRc,IAAAA,MAAM,EAAE,MAAM;AACZ;AACA9B,MAAAA,KAAK,CAAC+B,IAAN;AACA,aAAO/B,KAAK,CAACgC,MAAb;AACD;AA3DO,GAAV;AA8DA,SAAO1B,CAAP;AACD,CAxED","sourcesContent":["'use strict'\n\nconst Shake = require('it-handshake')\nconst lp = require('it-length-prefixed')\n\nmodule.exports = (duplex, opts = {}) => {\n  const shake = Shake(duplex)\n  const lpReader = lp.decode.fromReader(\n      shake.reader,\n      opts\n  )\n\n  let isDone = false\n\n  const W = {\n    read: async (bytes) => {\n      // just read\n\n      const { value, done } = await shake.reader.next(bytes)\n\n      if (done && value.length < bytes) {\n        throw new Error('Couldn\\'t read enough bytes')\n      }\n\n      isDone = done\n\n      if (!value) { throw new Error('Value is null') }\n      return value\n    },\n    readLP: async () => {\n      // read, decode\n      const { value, done } = await lpReader.next()\n\n      isDone = done\n\n      if (!value) { throw new Error('Value is null') }\n      return value\n    },\n    readPB: async (proto) => {\n      // readLP, decode\n      const value = await W.readLP()\n\n      if (!value) { throw new Error('Value is null') }\n\n      // Is this a Uint8Array?\n      const buf = value instanceof Uint8Array ? value : value.slice()\n\n      return proto.decode(buf)\n    },\n    write: (data) => {\n      // just write\n      shake.writer.push(data)\n    },\n    writeLP: (data) => {\n      // encode, write\n      W.write(lp.encode.single(data, opts))\n    },\n    writePB: (data, proto) => {\n      // encode, writeLP\n      W.writeLP(proto.encode(data))\n    },\n\n    pb: (proto) => {\n      return {\n        read: () => W.readPB(proto),\n        write: (d) => W.writePB(d, proto)\n      }\n    },\n\n    unwrap: () => {\n      // returns vanilla duplex again, terminates all reads/writes from this object\n      shake.rest()\n      return shake.stream\n    }\n  }\n\n  return W\n}\n"]},"metadata":{},"sourceType":"script"}