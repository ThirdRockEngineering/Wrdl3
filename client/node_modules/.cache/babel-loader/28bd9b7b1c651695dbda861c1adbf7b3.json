{"ast":null,"code":"'use strict';\n\nconst AbstractLevelDOWN = require('abstract-leveldown').AbstractLevelDOWN;\n\nconst AbstractChainedBatch = require('abstract-leveldown').AbstractChainedBatch;\n\nconst AbstractIterator = require('abstract-leveldown').AbstractIterator;\n\nconst inherits = require('inherits');\n\nconst Codec = require('level-codec');\n\nconst EncodingError = require('level-errors').EncodingError;\n\nconst rangeMethods = ['approximateSize', 'compactRange'];\nmodule.exports = DB;\n\nfunction DB(db, opts) {\n  if (!(this instanceof DB)) return new DB(db, opts);\n  const manifest = db.supports || {};\n  const additionalMethods = manifest.additionalMethods || {};\n  AbstractLevelDOWN.call(this, manifest);\n  this.supports.encodings = true;\n  this.supports.additionalMethods = {};\n  rangeMethods.forEach(function (m) {\n    // TODO (future major): remove this fallback\n    const fallback = typeof db[m] === 'function';\n\n    if (additionalMethods[m] || fallback) {\n      this.supports.additionalMethods[m] = true;\n\n      this[m] = function (start, end, opts, cb) {\n        start = this.codec.encodeKey(start, opts);\n        end = this.codec.encodeKey(end, opts);\n        return this.db[m](start, end, opts, cb);\n      };\n    }\n  }, this);\n  opts = opts || {};\n  if (typeof opts.keyEncoding === 'undefined') opts.keyEncoding = 'utf8';\n  if (typeof opts.valueEncoding === 'undefined') opts.valueEncoding = 'utf8';\n  this.db = db;\n  this.codec = new Codec(opts);\n}\n\ninherits(DB, AbstractLevelDOWN);\nDB.prototype.type = 'encoding-down';\n\nDB.prototype._serializeKey = DB.prototype._serializeValue = function (datum) {\n  return datum;\n};\n\nDB.prototype._open = function (opts, cb) {\n  this.db.open(opts, cb);\n};\n\nDB.prototype._close = function (cb) {\n  this.db.close(cb);\n};\n\nDB.prototype._put = function (key, value, opts, cb) {\n  key = this.codec.encodeKey(key, opts);\n  value = this.codec.encodeValue(value, opts);\n  this.db.put(key, value, opts, cb);\n};\n\nDB.prototype._get = function (key, opts, cb) {\n  key = this.codec.encodeKey(key, opts);\n  opts.asBuffer = this.codec.valueAsBuffer(opts);\n  this.db.get(key, opts, (err, value) => {\n    if (err) return cb(err);\n\n    try {\n      value = this.codec.decodeValue(value, opts);\n    } catch (err) {\n      return cb(new EncodingError(err));\n    }\n\n    cb(null, value);\n  });\n};\n\nDB.prototype._getMany = function (keys, opts, cb) {\n  keys = keys.map(key => this.codec.encodeKey(key, opts));\n  opts.asBuffer = this.codec.valueAsBuffer(opts);\n  this.db.getMany(keys, opts, (err, values) => {\n    if (err) return cb(err);\n    const decoded = new Array(values.length);\n\n    for (let i = 0; i < values.length; i++) {\n      if (values[i] === undefined) {\n        decoded[i] = undefined;\n        continue;\n      }\n\n      try {\n        decoded[i] = this.codec.decodeValue(values[i], opts);\n      } catch (err) {\n        return cb(new EncodingError(err));\n      }\n    }\n\n    cb(null, decoded);\n  });\n};\n\nDB.prototype._del = function (key, opts, cb) {\n  key = this.codec.encodeKey(key, opts);\n  this.db.del(key, opts, cb);\n};\n\nDB.prototype._chainedBatch = function () {\n  return new Batch(this);\n};\n\nDB.prototype._batch = function (ops, opts, cb) {\n  ops = this.codec.encodeBatch(ops, opts);\n  this.db.batch(ops, opts, cb);\n};\n\nDB.prototype._iterator = function (opts) {\n  opts.keyAsBuffer = this.codec.keyAsBuffer(opts);\n  opts.valueAsBuffer = this.codec.valueAsBuffer(opts);\n  return new Iterator(this, opts);\n};\n\nDB.prototype._clear = function (opts, callback) {\n  opts = this.codec.encodeLtgt(opts);\n  this.db.clear(opts, callback);\n};\n\nfunction Iterator(db, opts) {\n  AbstractIterator.call(this, db);\n  this.codec = db.codec;\n  this.keys = opts.keys;\n  this.values = opts.values;\n  this.opts = this.codec.encodeLtgt(opts);\n  this.it = db.db.iterator(this.opts);\n}\n\ninherits(Iterator, AbstractIterator);\n\nIterator.prototype._next = function (cb) {\n  this.it.next((err, key, value) => {\n    if (err) return cb(err);\n\n    try {\n      if (this.keys && typeof key !== 'undefined') {\n        key = this.codec.decodeKey(key, this.opts);\n      } else {\n        key = undefined;\n      }\n\n      if (this.values && typeof value !== 'undefined') {\n        value = this.codec.decodeValue(value, this.opts);\n      } else {\n        value = undefined;\n      }\n    } catch (err) {\n      return cb(new EncodingError(err));\n    }\n\n    cb(null, key, value);\n  });\n};\n\nIterator.prototype._seek = function (key) {\n  key = this.codec.encodeKey(key, this.opts);\n  this.it.seek(key);\n};\n\nIterator.prototype._end = function (cb) {\n  this.it.end(cb);\n};\n\nfunction Batch(db, codec) {\n  AbstractChainedBatch.call(this, db);\n  this.codec = db.codec;\n  this.batch = db.db.batch();\n}\n\ninherits(Batch, AbstractChainedBatch);\n\nBatch.prototype._put = function (key, value, options) {\n  key = this.codec.encodeKey(key, options);\n  value = this.codec.encodeValue(value, options);\n  this.batch.put(key, value);\n};\n\nBatch.prototype._del = function (key, options) {\n  key = this.codec.encodeKey(key, options);\n  this.batch.del(key);\n};\n\nBatch.prototype._clear = function () {\n  this.batch.clear();\n};\n\nBatch.prototype._write = function (opts, cb) {\n  this.batch.write(opts, cb);\n};","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/encoding-down/index.js"],"names":["AbstractLevelDOWN","require","AbstractChainedBatch","AbstractIterator","inherits","Codec","EncodingError","rangeMethods","module","exports","DB","db","opts","manifest","supports","additionalMethods","call","encodings","forEach","m","fallback","start","end","cb","codec","encodeKey","keyEncoding","valueEncoding","prototype","type","_serializeKey","_serializeValue","datum","_open","open","_close","close","_put","key","value","encodeValue","put","_get","asBuffer","valueAsBuffer","get","err","decodeValue","_getMany","keys","map","getMany","values","decoded","Array","length","i","undefined","_del","del","_chainedBatch","Batch","_batch","ops","encodeBatch","batch","_iterator","keyAsBuffer","Iterator","_clear","callback","encodeLtgt","clear","it","iterator","_next","next","decodeKey","_seek","seek","_end","options","_write","write"],"mappings":"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","sourcesContent":["'use strict'\n\nconst AbstractLevelDOWN = require('abstract-leveldown').AbstractLevelDOWN\nconst AbstractChainedBatch = require('abstract-leveldown').AbstractChainedBatch\nconst AbstractIterator = require('abstract-leveldown').AbstractIterator\nconst inherits = require('inherits')\nconst Codec = require('level-codec')\nconst EncodingError = require('level-errors').EncodingError\nconst rangeMethods = ['approximateSize', 'compactRange']\n\nmodule.exports = DB\n\nfunction DB (db, opts) {\n  if (!(this instanceof DB)) return new DB(db, opts)\n\n  const manifest = db.supports || {}\n  const additionalMethods = manifest.additionalMethods || {}\n\n  AbstractLevelDOWN.call(this, manifest)\n\n  this.supports.encodings = true\n  this.supports.additionalMethods = {}\n\n  rangeMethods.forEach(function (m) {\n    // TODO (future major): remove this fallback\n    const fallback = typeof db[m] === 'function'\n\n    if (additionalMethods[m] || fallback) {\n      this.supports.additionalMethods[m] = true\n\n      this[m] = function (start, end, opts, cb) {\n        start = this.codec.encodeKey(start, opts)\n        end = this.codec.encodeKey(end, opts)\n        return this.db[m](start, end, opts, cb)\n      }\n    }\n  }, this)\n\n  opts = opts || {}\n  if (typeof opts.keyEncoding === 'undefined') opts.keyEncoding = 'utf8'\n  if (typeof opts.valueEncoding === 'undefined') opts.valueEncoding = 'utf8'\n\n  this.db = db\n  this.codec = new Codec(opts)\n}\n\ninherits(DB, AbstractLevelDOWN)\n\nDB.prototype.type = 'encoding-down'\n\nDB.prototype._serializeKey =\nDB.prototype._serializeValue = function (datum) {\n  return datum\n}\n\nDB.prototype._open = function (opts, cb) {\n  this.db.open(opts, cb)\n}\n\nDB.prototype._close = function (cb) {\n  this.db.close(cb)\n}\n\nDB.prototype._put = function (key, value, opts, cb) {\n  key = this.codec.encodeKey(key, opts)\n  value = this.codec.encodeValue(value, opts)\n  this.db.put(key, value, opts, cb)\n}\n\nDB.prototype._get = function (key, opts, cb) {\n  key = this.codec.encodeKey(key, opts)\n  opts.asBuffer = this.codec.valueAsBuffer(opts)\n\n  this.db.get(key, opts, (err, value) => {\n    if (err) return cb(err)\n\n    try {\n      value = this.codec.decodeValue(value, opts)\n    } catch (err) {\n      return cb(new EncodingError(err))\n    }\n\n    cb(null, value)\n  })\n}\n\nDB.prototype._getMany = function (keys, opts, cb) {\n  keys = keys.map((key) => this.codec.encodeKey(key, opts))\n  opts.asBuffer = this.codec.valueAsBuffer(opts)\n\n  this.db.getMany(keys, opts, (err, values) => {\n    if (err) return cb(err)\n\n    const decoded = new Array(values.length)\n\n    for (let i = 0; i < values.length; i++) {\n      if (values[i] === undefined) {\n        decoded[i] = undefined\n        continue\n      }\n\n      try {\n        decoded[i] = this.codec.decodeValue(values[i], opts)\n      } catch (err) {\n        return cb(new EncodingError(err))\n      }\n    }\n\n    cb(null, decoded)\n  })\n}\n\nDB.prototype._del = function (key, opts, cb) {\n  key = this.codec.encodeKey(key, opts)\n  this.db.del(key, opts, cb)\n}\n\nDB.prototype._chainedBatch = function () {\n  return new Batch(this)\n}\n\nDB.prototype._batch = function (ops, opts, cb) {\n  ops = this.codec.encodeBatch(ops, opts)\n  this.db.batch(ops, opts, cb)\n}\n\nDB.prototype._iterator = function (opts) {\n  opts.keyAsBuffer = this.codec.keyAsBuffer(opts)\n  opts.valueAsBuffer = this.codec.valueAsBuffer(opts)\n  return new Iterator(this, opts)\n}\n\nDB.prototype._clear = function (opts, callback) {\n  opts = this.codec.encodeLtgt(opts)\n  this.db.clear(opts, callback)\n}\n\nfunction Iterator (db, opts) {\n  AbstractIterator.call(this, db)\n  this.codec = db.codec\n  this.keys = opts.keys\n  this.values = opts.values\n  this.opts = this.codec.encodeLtgt(opts)\n  this.it = db.db.iterator(this.opts)\n}\n\ninherits(Iterator, AbstractIterator)\n\nIterator.prototype._next = function (cb) {\n  this.it.next((err, key, value) => {\n    if (err) return cb(err)\n\n    try {\n      if (this.keys && typeof key !== 'undefined') {\n        key = this.codec.decodeKey(key, this.opts)\n      } else {\n        key = undefined\n      }\n\n      if (this.values && typeof value !== 'undefined') {\n        value = this.codec.decodeValue(value, this.opts)\n      } else {\n        value = undefined\n      }\n    } catch (err) {\n      return cb(new EncodingError(err))\n    }\n\n    cb(null, key, value)\n  })\n}\n\nIterator.prototype._seek = function (key) {\n  key = this.codec.encodeKey(key, this.opts)\n  this.it.seek(key)\n}\n\nIterator.prototype._end = function (cb) {\n  this.it.end(cb)\n}\n\nfunction Batch (db, codec) {\n  AbstractChainedBatch.call(this, db)\n  this.codec = db.codec\n  this.batch = db.db.batch()\n}\n\ninherits(Batch, AbstractChainedBatch)\n\nBatch.prototype._put = function (key, value, options) {\n  key = this.codec.encodeKey(key, options)\n  value = this.codec.encodeValue(value, options)\n  this.batch.put(key, value)\n}\n\nBatch.prototype._del = function (key, options) {\n  key = this.codec.encodeKey(key, options)\n  this.batch.del(key)\n}\n\nBatch.prototype._clear = function () {\n  this.batch.clear()\n}\n\nBatch.prototype._write = function (opts, cb) {\n  this.batch.write(opts, cb)\n}\n"]},"metadata":{},"sourceType":"script"}