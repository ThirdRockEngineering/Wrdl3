{"ast":null,"code":"'use strict';\n\nconst errCode = require('err-code');\n\nconst {\n  messages,\n  codes\n} = require('../errors');\n/**\n * @typedef {import('peer-id')} PeerId\n * @typedef {import('libp2p-interfaces/src/peer-routing/types').PeerRouting} PeerRoutingModule\n */\n\n/**\n * Wrapper class to convert events into returned values\n *\n * @implements {PeerRoutingModule}\n */\n\n\nclass DHTPeerRouting {\n  /**\n   * @param {import('libp2p-kad-dht').DHT} dht\n   */\n  constructor(dht) {\n    this._dht = dht;\n  }\n  /**\n   * @param {PeerId} peerId\n   * @param {any} options\n   */\n\n\n  async findPeer(peerId) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const event of this._dht.findPeer(peerId, options)) {\n      if (event.name === 'FINAL_PEER') {\n        return event.peer;\n      }\n    }\n\n    throw errCode(new Error(messages.NOT_FOUND), codes.ERR_NOT_FOUND);\n  }\n  /**\n   * @param {Uint8Array} key\n   * @param {any} options\n   */\n\n\n  async *getClosestPeers(key) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const event of this._dht.getClosestPeers(key, options)) {\n      if (event.name === 'PEER_RESPONSE') {\n        yield* event.closer;\n      }\n    }\n  }\n\n}\n\nmodule.exports = {\n  DHTPeerRouting\n};","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/libp2p/src/dht/dht-peer-routing.js"],"names":["errCode","require","messages","codes","DHTPeerRouting","constructor","dht","_dht","findPeer","peerId","options","event","name","peer","Error","NOT_FOUND","ERR_NOT_FOUND","getClosestPeers","key","closer","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,UAAD,CAAvB;;AACA,MAAM;AAAEC,EAAAA,QAAF;AAAYC,EAAAA;AAAZ,IAAsBF,OAAO,CAAC,WAAD,CAAnC;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AACA,MAAMG,cAAN,CAAqB;AACnB;AACF;AACA;AACEC,EAAAA,WAAW,CAAEC,GAAF,EAAO;AAChB,SAAKC,IAAL,GAAYD,GAAZ;AACD;AAED;AACF;AACA;AACA;;;AACgB,QAARE,QAAQ,CAAEC,MAAF,EAAwB;AAAA,QAAdC,OAAc,uEAAJ,EAAI;;AACpC,eAAW,MAAMC,KAAjB,IAA0B,KAAKJ,IAAL,CAAUC,QAAV,CAAmBC,MAAnB,EAA2BC,OAA3B,CAA1B,EAA+D;AAC7D,UAAIC,KAAK,CAACC,IAAN,KAAe,YAAnB,EAAiC;AAC/B,eAAOD,KAAK,CAACE,IAAb;AACD;AACF;;AAED,UAAMb,OAAO,CAAC,IAAIc,KAAJ,CAAUZ,QAAQ,CAACa,SAAnB,CAAD,EAAgCZ,KAAK,CAACa,aAAtC,CAAb;AACD;AAED;AACF;AACA;AACA;;;AACyB,SAAfC,eAAe,CAAEC,GAAF,EAAqB;AAAA,QAAdR,OAAc,uEAAJ,EAAI;;AAC1C,eAAW,MAAMC,KAAjB,IAA0B,KAAKJ,IAAL,CAAUU,eAAV,CAA0BC,GAA1B,EAA+BR,OAA/B,CAA1B,EAAmE;AACjE,UAAIC,KAAK,CAACC,IAAN,KAAe,eAAnB,EAAoC;AAClC,eAAQD,KAAK,CAACQ,MAAd;AACD;AACF;AACF;;AAhCkB;;AAmCrBC,MAAM,CAACC,OAAP,GAAiB;AAAEjB,EAAAA;AAAF,CAAjB","sourcesContent":["'use strict'\n\nconst errCode = require('err-code')\nconst { messages, codes } = require('../errors')\n\n/**\n * @typedef {import('peer-id')} PeerId\n * @typedef {import('libp2p-interfaces/src/peer-routing/types').PeerRouting} PeerRoutingModule\n */\n\n/**\n * Wrapper class to convert events into returned values\n *\n * @implements {PeerRoutingModule}\n */\nclass DHTPeerRouting {\n  /**\n   * @param {import('libp2p-kad-dht').DHT} dht\n   */\n  constructor (dht) {\n    this._dht = dht\n  }\n\n  /**\n   * @param {PeerId} peerId\n   * @param {any} options\n   */\n  async findPeer (peerId, options = {}) {\n    for await (const event of this._dht.findPeer(peerId, options)) {\n      if (event.name === 'FINAL_PEER') {\n        return event.peer\n      }\n    }\n\n    throw errCode(new Error(messages.NOT_FOUND), codes.ERR_NOT_FOUND)\n  }\n\n  /**\n   * @param {Uint8Array} key\n   * @param {any} options\n   */\n  async * getClosestPeers (key, options = {}) {\n    for await (const event of this._dht.getClosestPeers(key, options)) {\n      if (event.name === 'PEER_RESPONSE') {\n        yield * event.closer\n      }\n    }\n  }\n}\n\nmodule.exports = { DHTPeerRouting }\n"]},"metadata":{},"sourceType":"script"}