{"ast":null,"code":"'use strict';\n\nfunction AbstractIterator(db) {\n  if (typeof db !== 'object' || db === null) {\n    throw new TypeError('First argument must be an abstract-leveldown compliant store');\n  }\n\n  this.db = db;\n  this._ended = false;\n  this._nexting = false;\n}\n\nAbstractIterator.prototype.next = function (callback) {\n  var _this = this;\n\n  // In callback mode, we return `this`\n  let ret = this;\n\n  if (callback === undefined) {\n    ret = new Promise(function (resolve, reject) {\n      callback = function (err, key, value) {\n        if (err) reject(err);else if (key === undefined && value === undefined) resolve();else resolve([key, value]);\n      };\n    });\n  } else if (typeof callback !== 'function') {\n    throw new Error('next() requires a callback argument');\n  }\n\n  if (this._ended) {\n    this._nextTick(callback, new Error('cannot call next() after end()'));\n\n    return ret;\n  }\n\n  if (this._nexting) {\n    this._nextTick(callback, new Error('cannot call next() before previous next() has completed'));\n\n    return ret;\n  }\n\n  this._nexting = true;\n\n  this._next(function (err) {\n    _this._nexting = false;\n\n    for (var _len = arguments.length, rest = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      rest[_key - 1] = arguments[_key];\n    }\n\n    callback(err, ...rest);\n  });\n\n  return ret;\n};\n\nAbstractIterator.prototype._next = function (callback) {\n  this._nextTick(callback);\n};\n\nAbstractIterator.prototype.seek = function (target) {\n  if (this._ended) {\n    throw new Error('cannot call seek() after end()');\n  }\n\n  if (this._nexting) {\n    throw new Error('cannot call seek() before next() has completed');\n  }\n\n  target = this.db._serializeKey(target);\n\n  this._seek(target);\n};\n\nAbstractIterator.prototype._seek = function (target) {};\n\nAbstractIterator.prototype.end = function (callback) {\n  let promise;\n\n  if (callback === undefined) {\n    promise = new Promise(function (resolve, reject) {\n      callback = function (err) {\n        if (err) reject(err);else resolve();\n      };\n    });\n  } else if (typeof callback !== 'function') {\n    throw new Error('end() requires a callback argument');\n  }\n\n  if (this._ended) {\n    this._nextTick(callback, new Error('end() already called on iterator'));\n\n    return promise;\n  }\n\n  this._ended = true;\n\n  this._end(callback);\n\n  return promise;\n};\n\nAbstractIterator.prototype._end = function (callback) {\n  this._nextTick(callback);\n};\n\nAbstractIterator.prototype[Symbol.asyncIterator] = async function* () {\n  try {\n    let kv;\n\n    while ((kv = await this.next()) !== undefined) {\n      yield kv;\n    }\n  } finally {\n    if (!this._ended) await this.end();\n  }\n}; // Expose browser-compatible nextTick for dependents\n\n\nAbstractIterator.prototype._nextTick = require('./next-tick');\nmodule.exports = AbstractIterator;","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/abstract-leveldown/abstract-iterator.js"],"names":["AbstractIterator","db","TypeError","_ended","_nexting","prototype","next","callback","ret","undefined","Promise","resolve","reject","err","key","value","Error","_nextTick","_next","rest","seek","target","_serializeKey","_seek","end","promise","_end","Symbol","asyncIterator","kv","require","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nfunction AbstractIterator (db) {\n  if (typeof db !== 'object' || db === null) {\n    throw new TypeError('First argument must be an abstract-leveldown compliant store')\n  }\n\n  this.db = db\n  this._ended = false\n  this._nexting = false\n}\n\nAbstractIterator.prototype.next = function (callback) {\n  // In callback mode, we return `this`\n  let ret = this\n\n  if (callback === undefined) {\n    ret = new Promise(function (resolve, reject) {\n      callback = function (err, key, value) {\n        if (err) reject(err)\n        else if (key === undefined && value === undefined) resolve()\n        else resolve([key, value])\n      }\n    })\n  } else if (typeof callback !== 'function') {\n    throw new Error('next() requires a callback argument')\n  }\n\n  if (this._ended) {\n    this._nextTick(callback, new Error('cannot call next() after end()'))\n    return ret\n  }\n\n  if (this._nexting) {\n    this._nextTick(callback, new Error('cannot call next() before previous next() has completed'))\n    return ret\n  }\n\n  this._nexting = true\n  this._next((err, ...rest) => {\n    this._nexting = false\n    callback(err, ...rest)\n  })\n\n  return ret\n}\n\nAbstractIterator.prototype._next = function (callback) {\n  this._nextTick(callback)\n}\n\nAbstractIterator.prototype.seek = function (target) {\n  if (this._ended) {\n    throw new Error('cannot call seek() after end()')\n  }\n  if (this._nexting) {\n    throw new Error('cannot call seek() before next() has completed')\n  }\n\n  target = this.db._serializeKey(target)\n  this._seek(target)\n}\n\nAbstractIterator.prototype._seek = function (target) {}\n\nAbstractIterator.prototype.end = function (callback) {\n  let promise\n\n  if (callback === undefined) {\n    promise = new Promise(function (resolve, reject) {\n      callback = function (err) {\n        if (err) reject(err)\n        else resolve()\n      }\n    })\n  } else if (typeof callback !== 'function') {\n    throw new Error('end() requires a callback argument')\n  }\n\n  if (this._ended) {\n    this._nextTick(callback, new Error('end() already called on iterator'))\n    return promise\n  }\n\n  this._ended = true\n  this._end(callback)\n\n  return promise\n}\n\nAbstractIterator.prototype._end = function (callback) {\n  this._nextTick(callback)\n}\n\nAbstractIterator.prototype[Symbol.asyncIterator] = async function * () {\n  try {\n    let kv\n\n    while ((kv = (await this.next())) !== undefined) {\n      yield kv\n    }\n  } finally {\n    if (!this._ended) await this.end()\n  }\n}\n\n// Expose browser-compatible nextTick for dependents\nAbstractIterator.prototype._nextTick = require('./next-tick')\n\nmodule.exports = AbstractIterator\n"]},"metadata":{},"sourceType":"script"}