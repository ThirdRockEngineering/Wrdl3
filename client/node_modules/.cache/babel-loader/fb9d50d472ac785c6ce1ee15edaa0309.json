{"ast":null,"code":"'use strict';\n\nconst {\n  AbstractLevelDOWN\n} = require('abstract-leveldown');\n\nconst inherits = require('inherits');\n\nconst DeferredIterator = require('./deferred-iterator');\n\nconst DeferredChainedBatch = require('./deferred-chained-batch');\n\nconst getCallback = require('./util').getCallback;\n\nconst deferrables = ['put', 'get', 'getMany', 'del', 'batch', 'clear'];\nconst optionalDeferrables = ['approximateSize', 'compactRange'];\nconst kInnerDb = Symbol('innerDb');\nconst kOperations = Symbol('operations');\nconst kPromise = Symbol('promise');\n\nfunction DeferredLevelDOWN(db) {\n  AbstractLevelDOWN.call(this, db.supports || {}); // TODO (future major): remove this fallback; db must have manifest that\n  // declares approximateSize and compactRange in additionalMethods.\n\n  for (const m of optionalDeferrables) {\n    if (typeof db[m] === 'function' && !this.supports.additionalMethods[m]) {\n      this.supports.additionalMethods[m] = true;\n    }\n  }\n\n  this[kInnerDb] = db;\n  this[kOperations] = [];\n  implement(this);\n}\n\ninherits(DeferredLevelDOWN, AbstractLevelDOWN);\nDeferredLevelDOWN.prototype.type = 'deferred-leveldown'; // Backwards compatibility for reachdown and subleveldown\n\nObject.defineProperty(DeferredLevelDOWN.prototype, '_db', {\n  enumerable: true,\n\n  get() {\n    return this[kInnerDb];\n  }\n\n});\n\nDeferredLevelDOWN.prototype._open = function (options, callback) {\n  const onopen = err => {\n    if (err || this[kInnerDb].status !== 'open') {\n      // TODO: reject scheduled operations\n      return callback(err || new Error('Database is not open'));\n    }\n\n    const operations = this[kOperations];\n    this[kOperations] = [];\n\n    for (const op of operations) {\n      if (op.iterator) {\n        op.iterator.setDb(this[kInnerDb]);\n      } else {\n        this[kInnerDb][op.method](...op.args);\n      }\n    }\n    /* istanbul ignore if: assertion */\n\n\n    if (this[kOperations].length > 0) {\n      throw new Error('Did not expect further operations');\n    }\n\n    callback();\n  };\n\n  if (this[kInnerDb].status === 'new' || this[kInnerDb].status === 'closed') {\n    this[kInnerDb].open(options, onopen);\n  } else {\n    this._nextTick(onopen);\n  }\n};\n\nDeferredLevelDOWN.prototype._close = function (callback) {\n  this[kInnerDb].close(callback);\n};\n\nDeferredLevelDOWN.prototype._isOperational = function () {\n  return this.status === 'opening';\n};\n\nfunction implement(self) {\n  const additionalMethods = Object.keys(self.supports.additionalMethods);\n\n  for (const method of deferrables.concat(additionalMethods)) {\n    // Override the public rather than private methods to cover cases where abstract-leveldown\n    // has a fast-path like on db.batch([]) which bypasses _batch() because the array is empty.\n    self[method] = function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      if (method === 'batch' && args.length === 0) {\n        return new DeferredChainedBatch(this);\n      } else if (this.status === 'open') {\n        return this[kInnerDb][method](...args);\n      }\n\n      const callback = getCallback(args, kPromise);\n\n      if (this.status === 'opening') {\n        this[kOperations].push({\n          method,\n          args\n        });\n      } else {\n        this._nextTick(callback, new Error('Database is not open'));\n      }\n\n      return callback[kPromise];\n    };\n  }\n\n  self.iterator = function (options) {\n    if (this.status === 'open') {\n      return this[kInnerDb].iterator(options);\n    } else if (this.status === 'opening') {\n      const iterator = new DeferredIterator(this, options);\n      this[kOperations].push({\n        iterator\n      });\n      return iterator;\n    } else {\n      throw new Error('Database is not open');\n    }\n  };\n\n  for (const method of deferrables.concat(['iterator'])) {\n    self['_' + method] = function () {\n      /* istanbul ignore next: assertion */\n      throw new Error('Did not expect private method to be called: ' + method);\n    };\n  }\n}\n\nmodule.exports = DeferredLevelDOWN;\nmodule.exports.DeferredIterator = DeferredIterator;","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/deferred-leveldown/deferred-leveldown.js"],"names":["AbstractLevelDOWN","require","inherits","DeferredIterator","DeferredChainedBatch","getCallback","deferrables","optionalDeferrables","kInnerDb","Symbol","kOperations","kPromise","DeferredLevelDOWN","db","call","supports","m","additionalMethods","implement","prototype","type","Object","defineProperty","enumerable","get","_open","options","callback","onopen","err","status","Error","operations","op","iterator","setDb","method","args","length","open","_nextTick","_close","close","_isOperational","self","keys","concat","push","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst { AbstractLevelDOWN } = require('abstract-leveldown')\nconst inherits = require('inherits')\nconst DeferredIterator = require('./deferred-iterator')\nconst DeferredChainedBatch = require('./deferred-chained-batch')\nconst getCallback = require('./util').getCallback\n\nconst deferrables = ['put', 'get', 'getMany', 'del', 'batch', 'clear']\nconst optionalDeferrables = ['approximateSize', 'compactRange']\n\nconst kInnerDb = Symbol('innerDb')\nconst kOperations = Symbol('operations')\nconst kPromise = Symbol('promise')\n\nfunction DeferredLevelDOWN (db) {\n  AbstractLevelDOWN.call(this, db.supports || {})\n\n  // TODO (future major): remove this fallback; db must have manifest that\n  // declares approximateSize and compactRange in additionalMethods.\n  for (const m of optionalDeferrables) {\n    if (typeof db[m] === 'function' && !this.supports.additionalMethods[m]) {\n      this.supports.additionalMethods[m] = true\n    }\n  }\n\n  this[kInnerDb] = db\n  this[kOperations] = []\n\n  implement(this)\n}\n\ninherits(DeferredLevelDOWN, AbstractLevelDOWN)\n\nDeferredLevelDOWN.prototype.type = 'deferred-leveldown'\n\n// Backwards compatibility for reachdown and subleveldown\nObject.defineProperty(DeferredLevelDOWN.prototype, '_db', {\n  enumerable: true,\n  get () {\n    return this[kInnerDb]\n  }\n})\n\nDeferredLevelDOWN.prototype._open = function (options, callback) {\n  const onopen = (err) => {\n    if (err || this[kInnerDb].status !== 'open') {\n      // TODO: reject scheduled operations\n      return callback(err || new Error('Database is not open'))\n    }\n\n    const operations = this[kOperations]\n    this[kOperations] = []\n\n    for (const op of operations) {\n      if (op.iterator) {\n        op.iterator.setDb(this[kInnerDb])\n      } else {\n        this[kInnerDb][op.method](...op.args)\n      }\n    }\n\n    /* istanbul ignore if: assertion */\n    if (this[kOperations].length > 0) {\n      throw new Error('Did not expect further operations')\n    }\n\n    callback()\n  }\n\n  if (this[kInnerDb].status === 'new' || this[kInnerDb].status === 'closed') {\n    this[kInnerDb].open(options, onopen)\n  } else {\n    this._nextTick(onopen)\n  }\n}\n\nDeferredLevelDOWN.prototype._close = function (callback) {\n  this[kInnerDb].close(callback)\n}\n\nDeferredLevelDOWN.prototype._isOperational = function () {\n  return this.status === 'opening'\n}\n\nfunction implement (self) {\n  const additionalMethods = Object.keys(self.supports.additionalMethods)\n\n  for (const method of deferrables.concat(additionalMethods)) {\n    // Override the public rather than private methods to cover cases where abstract-leveldown\n    // has a fast-path like on db.batch([]) which bypasses _batch() because the array is empty.\n    self[method] = function (...args) {\n      if (method === 'batch' && args.length === 0) {\n        return new DeferredChainedBatch(this)\n      } else if (this.status === 'open') {\n        return this[kInnerDb][method](...args)\n      }\n\n      const callback = getCallback(args, kPromise)\n\n      if (this.status === 'opening') {\n        this[kOperations].push({ method, args })\n      } else {\n        this._nextTick(callback, new Error('Database is not open'))\n      }\n\n      return callback[kPromise]\n    }\n  }\n\n  self.iterator = function (options) {\n    if (this.status === 'open') {\n      return this[kInnerDb].iterator(options)\n    } else if (this.status === 'opening') {\n      const iterator = new DeferredIterator(this, options)\n      this[kOperations].push({ iterator })\n      return iterator\n    } else {\n      throw new Error('Database is not open')\n    }\n  }\n\n  for (const method of deferrables.concat(['iterator'])) {\n    self['_' + method] = function () {\n      /* istanbul ignore next: assertion */\n      throw new Error('Did not expect private method to be called: ' + method)\n    }\n  }\n}\n\nmodule.exports = DeferredLevelDOWN\nmodule.exports.DeferredIterator = DeferredIterator\n"]},"metadata":{},"sourceType":"script"}