{"ast":null,"code":"'use strict';\n\nconst select = require('./select');\n\nconst handle = require('./handle');\n\nconst ls = require('./ls');\n\nconst {\n  PROTOCOL_ID\n} = require('./constants');\n\nexports.PROTOCOL_ID = PROTOCOL_ID;\n/**\n * @typedef {import('bl/BufferList')} BufferList\n * @typedef {import('./types').DuplexStream<Uint8Array | BufferList>} DuplexStream\n * @typedef {import('./types').AbortOptions} AbortOptions\n */\n\nclass MultistreamSelect {\n  /**\n   * @param {DuplexStream} stream\n   */\n  constructor(stream) {\n    this._stream = stream;\n    this._shaken = false;\n  }\n  /**\n   * Perform the multistream-select handshake\n   *\n   * @param {AbortOptions} [options]\n   */\n\n\n  async _handshake(options) {\n    if (this._shaken) return;\n    const {\n      stream\n    } = await select(this._stream, PROTOCOL_ID, undefined, options);\n    this._stream = stream;\n    this._shaken = true;\n  }\n\n}\n\nclass Dialer extends MultistreamSelect {\n  /**\n   * @param {string | string[]} protocols\n   * @param {AbortOptions} [options]\n   */\n  select(protocols, options) {\n    return select(this._stream, protocols, this._shaken ? undefined : PROTOCOL_ID, options);\n  }\n  /**\n   * @param {AbortOptions} [options]\n   */\n\n\n  async ls(options) {\n    await this._handshake(options);\n    /** @type {{ stream: DuplexStream, protocols: string[] }} */\n\n    const res = await ls(this._stream, options);\n    const {\n      stream,\n      protocols\n    } = res;\n    this._stream = stream;\n    return protocols;\n  }\n\n}\n\nexports.Dialer = Dialer;\n\nclass Listener extends MultistreamSelect {\n  /**\n   * @param {string | string[]} protocols\n   * @param {AbortOptions} [options]\n   */\n  handle(protocols, options) {\n    return handle(this._stream, protocols, options);\n  }\n\n}\n\nexports.Listener = Listener;","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/multistream-select/src/index.js"],"names":["select","require","handle","ls","PROTOCOL_ID","exports","MultistreamSelect","constructor","stream","_stream","_shaken","_handshake","options","undefined","Dialer","protocols","res","Listener"],"mappings":"AAAA;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,UAAD,CAAtB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,UAAD,CAAtB;;AACA,MAAME,EAAE,GAAGF,OAAO,CAAC,MAAD,CAAlB;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAAkBH,OAAO,CAAC,aAAD,CAA/B;;AAEAI,OAAO,CAACD,WAAR,GAAsBA,WAAtB;AAEA;AACA;AACA;AACA;AACA;;AAEA,MAAME,iBAAN,CAAwB;AACtB;AACF;AACA;AACEC,EAAAA,WAAW,CAAEC,MAAF,EAAU;AACnB,SAAKC,OAAL,GAAeD,MAAf;AACA,SAAKE,OAAL,GAAe,KAAf;AACD;AAED;AACF;AACA;AACA;AACA;;;AACkB,QAAVC,UAAU,CAAEC,OAAF,EAAW;AACzB,QAAI,KAAKF,OAAT,EAAkB;AAClB,UAAM;AAAEF,MAAAA;AAAF,QAAa,MAAMR,MAAM,CAAC,KAAKS,OAAN,EAAeL,WAAf,EAA4BS,SAA5B,EAAuCD,OAAvC,CAA/B;AACA,SAAKH,OAAL,GAAeD,MAAf;AACA,SAAKE,OAAL,GAAe,IAAf;AACD;;AAnBqB;;AAsBxB,MAAMI,MAAN,SAAqBR,iBAArB,CAAuC;AACrC;AACF;AACA;AACA;AACEN,EAAAA,MAAM,CAAEe,SAAF,EAAaH,OAAb,EAAsB;AAC1B,WAAOZ,MAAM,CAAC,KAAKS,OAAN,EAAeM,SAAf,EAA0B,KAAKL,OAAL,GAAeG,SAAf,GAA2BT,WAArD,EAAkEQ,OAAlE,CAAb;AACD;AAED;AACF;AACA;;;AACU,QAAFT,EAAE,CAAES,OAAF,EAAW;AACjB,UAAM,KAAKD,UAAL,CAAgBC,OAAhB,CAAN;AACA;;AACA,UAAMI,GAAG,GAAG,MAAMb,EAAE,CAAC,KAAKM,OAAN,EAAeG,OAAf,CAApB;AACA,UAAM;AAAEJ,MAAAA,MAAF;AAAUO,MAAAA;AAAV,QAAwBC,GAA9B;AACA,SAAKP,OAAL,GAAeD,MAAf;AACA,WAAOO,SAAP;AACD;;AAnBoC;;AAsBvCV,OAAO,CAACS,MAAR,GAAiBA,MAAjB;;AAEA,MAAMG,QAAN,SAAuBX,iBAAvB,CAAyC;AACvC;AACF;AACA;AACA;AACEJ,EAAAA,MAAM,CAAEa,SAAF,EAAaH,OAAb,EAAsB;AAC1B,WAAOV,MAAM,CAAC,KAAKO,OAAN,EAAeM,SAAf,EAA0BH,OAA1B,CAAb;AACD;;AAPsC;;AAUzCP,OAAO,CAACY,QAAR,GAAmBA,QAAnB","sourcesContent":["'use strict'\n\nconst select = require('./select')\nconst handle = require('./handle')\nconst ls = require('./ls')\nconst { PROTOCOL_ID } = require('./constants')\n\nexports.PROTOCOL_ID = PROTOCOL_ID\n\n/**\n * @typedef {import('bl/BufferList')} BufferList\n * @typedef {import('./types').DuplexStream<Uint8Array | BufferList>} DuplexStream\n * @typedef {import('./types').AbortOptions} AbortOptions\n */\n\nclass MultistreamSelect {\n  /**\n   * @param {DuplexStream} stream\n   */\n  constructor (stream) {\n    this._stream = stream\n    this._shaken = false\n  }\n\n  /**\n   * Perform the multistream-select handshake\n   *\n   * @param {AbortOptions} [options]\n   */\n  async _handshake (options) {\n    if (this._shaken) return\n    const { stream } = await select(this._stream, PROTOCOL_ID, undefined, options)\n    this._stream = stream\n    this._shaken = true\n  }\n}\n\nclass Dialer extends MultistreamSelect {\n  /**\n   * @param {string | string[]} protocols\n   * @param {AbortOptions} [options]\n   */\n  select (protocols, options) {\n    return select(this._stream, protocols, this._shaken ? undefined : PROTOCOL_ID, options)\n  }\n\n  /**\n   * @param {AbortOptions} [options]\n   */\n  async ls (options) {\n    await this._handshake(options)\n    /** @type {{ stream: DuplexStream, protocols: string[] }} */\n    const res = await ls(this._stream, options)\n    const { stream, protocols } = res\n    this._stream = stream\n    return protocols\n  }\n}\n\nexports.Dialer = Dialer\n\nclass Listener extends MultistreamSelect {\n  /**\n   * @param {string | string[]} protocols\n   * @param {AbortOptions} [options]\n   */\n  handle (protocols, options) {\n    return handle(this._stream, protocols, options)\n  }\n}\n\nexports.Listener = Listener\n"]},"metadata":{},"sourceType":"script"}