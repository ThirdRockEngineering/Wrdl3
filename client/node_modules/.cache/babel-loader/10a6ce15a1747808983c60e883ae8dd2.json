{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar drain = require('it-drain');\n\nvar filter = require('it-filter');\n\nvar take = require('it-take');\n\nvar all = require('it-all');\n\nfunction _interopDefaultLegacy(e) {\n  return e && typeof e === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\n\nvar drain__default = /*#__PURE__*/_interopDefaultLegacy(drain);\n\nvar filter__default = /*#__PURE__*/_interopDefaultLegacy(filter);\n\nvar take__default = /*#__PURE__*/_interopDefaultLegacy(take);\n\nvar all__default = /*#__PURE__*/_interopDefaultLegacy(all);\n\nconst sortAll = (iterable, sorter) => {\n  return async function* () {\n    const values = await all__default[\"default\"](iterable);\n    yield* values.sort(sorter);\n  }();\n};\n\nclass BaseBlockstore {\n  open() {\n    return Promise.reject(new Error('.open is not implemented'));\n  }\n\n  close() {\n    return Promise.reject(new Error('.close is not implemented'));\n  }\n\n  put(key, val, options) {\n    return Promise.reject(new Error('.put is not implemented'));\n  }\n\n  get(key, options) {\n    return Promise.reject(new Error('.get is not implemented'));\n  }\n\n  has(key, options) {\n    return Promise.reject(new Error('.has is not implemented'));\n  }\n\n  delete(key, options) {\n    return Promise.reject(new Error('.delete is not implemented'));\n  }\n\n  async *putMany(source) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const {\n      key,\n      value\n    } of source) {\n      await this.put(key, value, options);\n      yield {\n        key,\n        value\n      };\n    }\n  }\n\n  async *getMany(source) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const key of source) {\n      yield this.get(key, options);\n    }\n  }\n\n  async *deleteMany(source) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    for await (const key of source) {\n      await this.delete(key, options);\n      yield key;\n    }\n  }\n\n  batch() {\n    let puts = [];\n    let dels = [];\n    return {\n      put(key, value) {\n        puts.push({\n          key,\n          value\n        });\n      },\n\n      delete(key) {\n        dels.push(key);\n      },\n\n      commit: async options => {\n        await drain__default[\"default\"](this.putMany(puts, options));\n        puts = [];\n        await drain__default[\"default\"](this.deleteMany(dels, options));\n        dels = [];\n      }\n    };\n  }\n\n  async *_all(q, options) {\n    throw new Error('._all is not implemented');\n  }\n\n  async *_allKeys(q, options) {\n    throw new Error('._allKeys is not implemented');\n  }\n\n  query(q, options) {\n    let it = this._all(q, options);\n\n    if (q.prefix != null) {\n      it = filter__default[\"default\"](it, e => e.key.toString().startsWith(q.prefix || ''));\n    }\n\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter__default[\"default\"](it, f), it);\n    }\n\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n\n    if (q.offset != null) {\n      let i = 0;\n      it = filter__default[\"default\"](it, () => i++ >= (q.offset || 0));\n    }\n\n    if (q.limit != null) {\n      it = take__default[\"default\"](it, q.limit);\n    }\n\n    return it;\n  }\n\n  queryKeys(q, options) {\n    let it = this._allKeys(q, options);\n\n    if (q.prefix != null) {\n      it = filter__default[\"default\"](it, cid => cid.toString().startsWith(q.prefix || ''));\n    }\n\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter__default[\"default\"](it, f), it);\n    }\n\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n\n    if (q.offset != null) {\n      let i = 0;\n      it = filter__default[\"default\"](it, () => i++ >= q.offset);\n    }\n\n    if (q.limit != null) {\n      it = take__default[\"default\"](it, q.limit);\n    }\n\n    return it;\n  }\n\n}\n\nexports.BaseBlockstore = BaseBlockstore;","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/blockstore-core/cjs/src/base.js"],"names":["Object","defineProperty","exports","value","drain","require","filter","take","all","_interopDefaultLegacy","e","drain__default","filter__default","take__default","all__default","sortAll","iterable","sorter","values","sort","BaseBlockstore","open","Promise","reject","Error","close","put","key","val","options","get","has","delete","putMany","source","getMany","deleteMany","batch","puts","dels","push","commit","_all","q","_allKeys","query","it","prefix","toString","startsWith","Array","isArray","filters","reduce","f","orders","offset","i","limit","queryKeys","cid"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar drain = require('it-drain');\nvar filter = require('it-filter');\nvar take = require('it-take');\nvar all = require('it-all');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar drain__default = /*#__PURE__*/_interopDefaultLegacy(drain);\nvar filter__default = /*#__PURE__*/_interopDefaultLegacy(filter);\nvar take__default = /*#__PURE__*/_interopDefaultLegacy(take);\nvar all__default = /*#__PURE__*/_interopDefaultLegacy(all);\n\nconst sortAll = (iterable, sorter) => {\n  return async function* () {\n    const values = await all__default[\"default\"](iterable);\n    yield* values.sort(sorter);\n  }();\n};\nclass BaseBlockstore {\n  open() {\n    return Promise.reject(new Error('.open is not implemented'));\n  }\n  close() {\n    return Promise.reject(new Error('.close is not implemented'));\n  }\n  put(key, val, options) {\n    return Promise.reject(new Error('.put is not implemented'));\n  }\n  get(key, options) {\n    return Promise.reject(new Error('.get is not implemented'));\n  }\n  has(key, options) {\n    return Promise.reject(new Error('.has is not implemented'));\n  }\n  delete(key, options) {\n    return Promise.reject(new Error('.delete is not implemented'));\n  }\n  async *putMany(source, options = {}) {\n    for await (const {key, value} of source) {\n      await this.put(key, value, options);\n      yield {\n        key,\n        value\n      };\n    }\n  }\n  async *getMany(source, options = {}) {\n    for await (const key of source) {\n      yield this.get(key, options);\n    }\n  }\n  async *deleteMany(source, options = {}) {\n    for await (const key of source) {\n      await this.delete(key, options);\n      yield key;\n    }\n  }\n  batch() {\n    let puts = [];\n    let dels = [];\n    return {\n      put(key, value) {\n        puts.push({\n          key,\n          value\n        });\n      },\n      delete(key) {\n        dels.push(key);\n      },\n      commit: async options => {\n        await drain__default[\"default\"](this.putMany(puts, options));\n        puts = [];\n        await drain__default[\"default\"](this.deleteMany(dels, options));\n        dels = [];\n      }\n    };\n  }\n  async *_all(q, options) {\n    throw new Error('._all is not implemented');\n  }\n  async *_allKeys(q, options) {\n    throw new Error('._allKeys is not implemented');\n  }\n  query(q, options) {\n    let it = this._all(q, options);\n    if (q.prefix != null) {\n      it = filter__default[\"default\"](it, e => e.key.toString().startsWith(q.prefix || ''));\n    }\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter__default[\"default\"](it, f), it);\n    }\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n    if (q.offset != null) {\n      let i = 0;\n      it = filter__default[\"default\"](it, () => i++ >= (q.offset || 0));\n    }\n    if (q.limit != null) {\n      it = take__default[\"default\"](it, q.limit);\n    }\n    return it;\n  }\n  queryKeys(q, options) {\n    let it = this._allKeys(q, options);\n    if (q.prefix != null) {\n      it = filter__default[\"default\"](it, cid => cid.toString().startsWith(q.prefix || ''));\n    }\n    if (Array.isArray(q.filters)) {\n      it = q.filters.reduce((it, f) => filter__default[\"default\"](it, f), it);\n    }\n    if (Array.isArray(q.orders)) {\n      it = q.orders.reduce((it, f) => sortAll(it, f), it);\n    }\n    if (q.offset != null) {\n      let i = 0;\n      it = filter__default[\"default\"](it, () => i++ >= q.offset);\n    }\n    if (q.limit != null) {\n      it = take__default[\"default\"](it, q.limit);\n    }\n    return it;\n  }\n}\n\nexports.BaseBlockstore = BaseBlockstore;\n"]},"metadata":{},"sourceType":"script"}