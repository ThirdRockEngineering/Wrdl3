{"ast":null,"code":"'use strict';\n/**\n * @template K\n * @template V\n */\n\nclass TrackedMap extends Map {\n  /**\n   * @param {object} options\n   * @param {string} options.system\n   * @param {string} options.component\n   * @param {string} options.metric\n   * @param {import('.')} options.metrics\n   */\n  constructor(options) {\n    super();\n    const {\n      system,\n      component,\n      metric,\n      metrics\n    } = options;\n    this._system = system;\n    this._component = component;\n    this._metric = metric;\n    this._metrics = metrics;\n\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    });\n  }\n  /**\n   * @param {K} key\n   * @param {V} value\n   */\n\n\n  set(key, value) {\n    super.set(key, value);\n\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    });\n\n    return this;\n  }\n  /**\n   * @param {K} key\n   */\n\n\n  delete(key) {\n    const deleted = super.delete(key);\n\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    });\n\n    return deleted;\n  }\n\n  clear() {\n    super.clear();\n\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    });\n  }\n\n}\n/**\n * @template K\n * @template V\n * @param {object} options\n * @param {string} [options.system]\n * @param {string} options.component\n * @param {string} options.metric\n * @param {import('.')} [options.metrics]\n * @returns {Map<K, V>}\n */\n\n\nmodule.exports = _ref => {\n  let {\n    system = 'libp2p',\n    component,\n    metric,\n    metrics\n  } = _ref;\n\n  /** @type {Map<K, V>} */\n  let map;\n\n  if (metrics) {\n    map = new TrackedMap({\n      system,\n      component,\n      metric,\n      metrics\n    });\n  } else {\n    map = new Map();\n  }\n\n  return map;\n};","map":{"version":3,"sources":["/Users/emilsharafutdinov/Desktop/Work/SR3/Wrdl3/client/node_modules/libp2p/src/metrics/tracked-map.js"],"names":["TrackedMap","Map","constructor","options","system","component","metric","metrics","_system","_component","_metric","_metrics","updateComponentMetric","value","size","set","key","delete","deleted","clear","module","exports","map"],"mappings":"AAAA;AAEA;AACA;AACA;AACA;;AACA,MAAMA,UAAN,SAAyBC,GAAzB,CAA6B;AAC3B;AACF;AACA;AACA;AACA;AACA;AACA;AACEC,EAAAA,WAAW,CAAEC,OAAF,EAAW;AACpB;AAEA,UAAM;AAAEC,MAAAA,MAAF;AAAUC,MAAAA,SAAV;AAAqBC,MAAAA,MAArB;AAA6BC,MAAAA;AAA7B,QAAyCJ,OAA/C;AACA,SAAKK,OAAL,GAAeJ,MAAf;AACA,SAAKK,UAAL,GAAkBJ,SAAlB;AACA,SAAKK,OAAL,GAAeJ,MAAf;AACA,SAAKK,QAAL,GAAgBJ,OAAhB;;AAEA,SAAKI,QAAL,CAAcC,qBAAd,CAAoC;AAClCR,MAAAA,MAAM,EAAE,KAAKI,OADqB;AAElCH,MAAAA,SAAS,EAAE,KAAKI,UAFkB;AAGlCH,MAAAA,MAAM,EAAE,KAAKI,OAHqB;AAIlCG,MAAAA,KAAK,EAAE,KAAKC;AAJsB,KAApC;AAMD;AAED;AACF;AACA;AACA;;;AACEC,EAAAA,GAAG,CAAEC,GAAF,EAAOH,KAAP,EAAc;AACf,UAAME,GAAN,CAAUC,GAAV,EAAeH,KAAf;;AACA,SAAKF,QAAL,CAAcC,qBAAd,CAAoC;AAClCR,MAAAA,MAAM,EAAE,KAAKI,OADqB;AAElCH,MAAAA,SAAS,EAAE,KAAKI,UAFkB;AAGlCH,MAAAA,MAAM,EAAE,KAAKI,OAHqB;AAIlCG,MAAAA,KAAK,EAAE,KAAKC;AAJsB,KAApC;;AAMA,WAAO,IAAP;AACD;AAED;AACF;AACA;;;AACEG,EAAAA,MAAM,CAAED,GAAF,EAAO;AACX,UAAME,OAAO,GAAG,MAAMD,MAAN,CAAaD,GAAb,CAAhB;;AACA,SAAKL,QAAL,CAAcC,qBAAd,CAAoC;AAClCR,MAAAA,MAAM,EAAE,KAAKI,OADqB;AAElCH,MAAAA,SAAS,EAAE,KAAKI,UAFkB;AAGlCH,MAAAA,MAAM,EAAE,KAAKI,OAHqB;AAIlCG,MAAAA,KAAK,EAAE,KAAKC;AAJsB,KAApC;;AAMA,WAAOI,OAAP;AACD;;AAEDC,EAAAA,KAAK,GAAI;AACP,UAAMA,KAAN;;AAEA,SAAKR,QAAL,CAAcC,qBAAd,CAAoC;AAClCR,MAAAA,MAAM,EAAE,KAAKI,OADqB;AAElCH,MAAAA,SAAS,EAAE,KAAKI,UAFkB;AAGlCH,MAAAA,MAAM,EAAE,KAAKI,OAHqB;AAIlCG,MAAAA,KAAK,EAAE,KAAKC;AAJsB,KAApC;AAMD;;AA/D0B;AAkE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAM,MAAM,CAACC,OAAP,GAAiB,QAAuD;AAAA,MAAtD;AAAEjB,IAAAA,MAAM,GAAG,QAAX;AAAqBC,IAAAA,SAArB;AAAgCC,IAAAA,MAAhC;AAAwCC,IAAAA;AAAxC,GAAsD;;AACtE;AACA,MAAIe,GAAJ;;AAEA,MAAIf,OAAJ,EAAa;AACXe,IAAAA,GAAG,GAAG,IAAItB,UAAJ,CAAe;AAAEI,MAAAA,MAAF;AAAUC,MAAAA,SAAV;AAAqBC,MAAAA,MAArB;AAA6BC,MAAAA;AAA7B,KAAf,CAAN;AACD,GAFD,MAEO;AACLe,IAAAA,GAAG,GAAG,IAAIrB,GAAJ,EAAN;AACD;;AAED,SAAOqB,GAAP;AACD,CAXD","sourcesContent":["'use strict'\n\n/**\n * @template K\n * @template V\n */\nclass TrackedMap extends Map {\n  /**\n   * @param {object} options\n   * @param {string} options.system\n   * @param {string} options.component\n   * @param {string} options.metric\n   * @param {import('.')} options.metrics\n   */\n  constructor (options) {\n    super()\n\n    const { system, component, metric, metrics } = options\n    this._system = system\n    this._component = component\n    this._metric = metric\n    this._metrics = metrics\n\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    })\n  }\n\n  /**\n   * @param {K} key\n   * @param {V} value\n   */\n  set (key, value) {\n    super.set(key, value)\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    })\n    return this\n  }\n\n  /**\n   * @param {K} key\n   */\n  delete (key) {\n    const deleted = super.delete(key)\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    })\n    return deleted\n  }\n\n  clear () {\n    super.clear()\n\n    this._metrics.updateComponentMetric({\n      system: this._system,\n      component: this._component,\n      metric: this._metric,\n      value: this.size\n    })\n  }\n}\n\n/**\n * @template K\n * @template V\n * @param {object} options\n * @param {string} [options.system]\n * @param {string} options.component\n * @param {string} options.metric\n * @param {import('.')} [options.metrics]\n * @returns {Map<K, V>}\n */\nmodule.exports = ({ system = 'libp2p', component, metric, metrics }) => {\n  /** @type {Map<K, V>} */\n  let map\n\n  if (metrics) {\n    map = new TrackedMap({ system, component, metric, metrics })\n  } else {\n    map = new Map()\n  }\n\n  return map\n}\n"]},"metadata":{},"sourceType":"script"}